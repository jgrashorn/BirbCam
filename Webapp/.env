# ============================================================================
# BirbCam Environment Configuration
# ============================================================================
# Copy this file to .env and adjust the values for your setup
# Source with: source .env

# ============================================================================
# CORE SYSTEM SETTINGS
# ============================================================================

# Camera identifier (should match MediaMTX stream path)
BIRBCAM_CAMERA=garten

# Logging level for motion detection script (DEBUG, INFO, WARNING, ERROR)
BIRBCAM_LOG=INFO

# ============================================================================
# DIRECTORY PATHS
# ============================================================================

# Directory where MediaMTX writes recorded MP4 files
# This is the input directory for motion detection
BIRBCAM_MEDIA_DIR=/mnt/birbtmp/mediamtx/recordings

# Directory where processed motion clips are stored  
# This is where the webapp serves recordings from
BIRBCAM_OUTPUT_DIR=/home/birb/BirbCam/Webapp/recordings

# Temporary directory for FFmpeg preprocessing (should be fast storage)
BIRBCAM_TEMP_DIR=/mnt/birbtmp/temp

# ============================================================================
# MOTION DETECTION PARAMETERS
# ============================================================================

# Frame sampling rate for motion detection (frames per second to analyze)
# Lower = faster processing, higher = more accurate detection
BIRBCAM_SAMPLE_FPS=2

# Target width for frame analysis (height calculated automatically)
# Lower = faster processing, higher = more detailed analysis
BIRBCAM_RESIZE_W=180

# Pixel difference threshold (0-255, higher = less sensitive)
BIRBCAM_DIFF_THRESH=25

# Minimum changed pixels to consider motion
BIRBCAM_MIN_CHANGED_PIXELS=200

# Minimum consecutive frames with motion to trigger detection
BIRBCAM_MIN_MOTION_FRAMES=1

# Maximum seconds to merge nearby motion windows
BIRBCAM_MERGE_GAP=1.5

# ============================================================================
# CLIP EXPORT BEHAVIOR
# ============================================================================

# Seconds to include before motion starts
BIRBCAM_PRE_BUFFER=2.0

# Seconds to include after motion ends
BIRBCAM_POST_BUFFER=3.0

# If motion ends within N seconds of video end, consider for joining
BIRBCAM_TAIL_NEAR_END=1.0

# If motion starts within N seconds of video start, consider for joining
BIRBCAM_HEAD_NEAR_START=1.0

# ============================================================================
# PERFORMANCE OPTIMIZATION
# ============================================================================

# Use FFmpeg preprocessing for faster motion detection (1=enabled, 0=disabled)
# Recommended: 1 (much faster frame reading)
BIRBCAM_USE_FFMPEG_PREPROCESS=1

# Only process files newer than N minutes (0 = no limit)
# Helps with performance on systems with many old files
BIRBCAM_MAX_AGE_MIN=360

# Maximum number of files to process per run (prevents runaway processing)
BIRBCAM_MAX_FILES=20

# ============================================================================
# FILE STABILITY DETECTION
# ============================================================================

# Minimum age (seconds) before a file is considered stable
# Files younger than this are skipped (still being written)
BIRBCAM_STABLE_MIN_AGE=5.0

# Time to wait between size checks when determining file stability
BIRBCAM_STABLE_POLL_SECONDS=1.0

# ============================================================================
# DEBUG AND TESTING
# ============================================================================

# Dry run mode - analyze but don't create output files (1=enabled, 0=disabled)
BIRBCAM_DRY_RUN=0

# ============================================================================
# USAGE EXAMPLES AND RECOMMENDATIONS
# ============================================================================

# For high-performance systems (fast CPU, SSD storage):
# BIRBCAM_SAMPLE_FPS=3
# BIRBCAM_RESIZE_W=240
# BIRBCAM_MAX_FILES=50

# For low-performance systems (Raspberry Pi, slow storage):
# BIRBCAM_SAMPLE_FPS=1
# BIRBCAM_RESIZE_W=120
# BIRBCAM_MAX_FILES=10

# For testing and development:
# BIRBCAM_LOG=DEBUG
# BIRBCAM_DRY_RUN=1
# BIRBCAM_MAX_FILES=5

# For very sensitive motion detection:
# BIRBCAM_DIFF_THRESH=15
# BIRBCAM_MIN_CHANGED_PIXELS=100
# BIRBCAM_MIN_MOTION_FRAMES=2

# For less sensitive motion detection (reduce false positives):
# BIRBCAM_DIFF_THRESH=40
# BIRBCAM_MIN_CHANGED_PIXELS=400
# BIRBCAM_MIN_MOTION_FRAMES=3